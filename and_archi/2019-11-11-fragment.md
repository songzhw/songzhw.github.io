## I. Introduction
Fragment has been made since 2011 for the support of tablet on Android 3.0+. The original intention is that it can help us to write once, but two different UI for phones and tablets. 

[Fragment's usage on different devices](https://i.stack.imgur.com/FtzKs.png)

But this seems only works for the list. More complex UI is hard to fulfill this goal. However, smart developers found out that Fragment actually could do a single part of UI View, so we could compose different Fragment to one screen, and, oh yearh, we could reuse our View code. Wasn't it wonderful?!

I was one of these excited developers. But after several years of using Fragment, I have to say, Fragment is one of the worst product in the Android world. Wait a minute, I am not here to declare a war, please allow me to explain more details.

## II. Transaction
 
### 2.1 commit() and state loss

One of the most common crash I can see is `java.lang.IllegalStateException: Can not perform this action after onSaveInstanceState`. 

This exception is Android trying to tell you that if you update the Fragment after the app is being backgrounded or killed, then your update might be recorded in teh onSaveInstanceState(). So next time you bring back the app, this kind of update would be lost. 

I get it, and it's good. But sometimes we do not know when is the time to call `fragment.commit()`, especially your `fragment.commit()` happens in one async callback. It's totally possible that I just send a HTTPS reqeust to fetch something, and then the user backgrounds our app. When the response arrives, we want to do something and call `newFragment.commit()`.
One possible solution is to use `fragment.commitAllowingStateLoss()`.  `commitAllowingStateLoss()` is not a good idea in generally, you can only use it when you are really sure this kind of update is okay to be lost. Remeber to pay attention to this `commitAllowingStateLoss()` method when you are reviewing your colleage's PR.

### 2.2 no commitAllowingStateLoss()?
`AlertDialog` is now not encouraged to use. Instead, Google suggests you to use `DialogFragment`. That's fine. But if you want to commit a dialog in a async callback, and you have put your app in the background, you will get the previous error agagin.

Just unfortunately for us, `DialogFragment` does not have the `commitAllowingStateLoss()` method. Yeah, I am so frustrated by this reality when I had this error, and I still have no good solution for this. In my opinion, if the app is killed accidently, and is brought back to foreground, it really is not a big deal that if the dialog is not showing. But a mandatory crash seems a overkill.

### 2.3 dialogFragment.dismiss()
Now I have a business scenario: I have to dismiss a popped up dialog first, then go fetch something from the backend. If I can get the successful response, then I can go to the next Activity. Here is the code

```java
// ResetPasswordDialog
this.dismiss();
anotherDialogFragment.sow(fragmentManager, tag)
httpEngine.fetch(){ resp ->
      mActivity.startActivity(someIntent)
}
```

You may have guessed what could happen. My app crashes: `java.lang.NullPointException : mActivity is null`.
Yes, after `this.dismiss`, the `mActivity` is now detached, and the value is null.

I don't want to say this is all Fragment's fault. But if this code is happening in an Activity:

```java
alertDialog.dismiss()
...
this.startActivity(someIntent)
```

Then it's definitely okay to run. And we now find out one important thing: Google treating Fragment and Activity are two things, and the reality that they both play as a role of `ViewController` (iOS term, which is super accurate here), makes our developerment life miserable. 

Actually, this is the root reason that why Framgent is bad. It's because Google don't know Fragment's position. Sometimes, it works like an Activity (so some other devs may say: we could have one activity and many fragments in one single app); and other times, people treats Fragments as a view, a UI component. This kind of confusion actually make the code hard to be consistent. 

## III. Why can't Fragment be a replacement of Activity?

I know Jake Wharton, a very respectful developer, had a talk, to introduce a new design: one activity + many fragment. 
I have to say, Jake Wharton is very smart, and he apparently noticed one of the greatest weakness of fragment. 

Many things that Fragments can do could also be done by Activity. And I have to say, Activity is even more powerful, then why should I use Fragment?

### 3.1 intent flag
Intent Flag is a very powerful weapon to deal with the stack. My iOS colleage is envy me that I can manipulate the activity stack so flexibly. But only Activities has intent flag. Fragment does not. 

This means you can not do `clear_top`, `single_top` and otehr intent flag to Fragment. This is a great loss.

### 3.2